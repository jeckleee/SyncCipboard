# 文件同步功能使用指南

## 📋 功能概述

SyncClipboard 现已支持跨设备文件同步功能！除了文本内容，你还可以在不同设备间同步文件。

## ⚙️ 配置说明

在 `config.ini` 文件中添加了新的配置项：

```ini
[client]
max_file_size = 5       ;文件同步最大体积限制（单位：MB）
```

### 配置选项

| 配置值 | 说明 | 行为 |
|--------|------|------|
| `false` | 禁用文件同步 | 复制文件时不同步，不显示任何提示 |
| `0` | 无限制 | 同步任意大小的文件 |
| `数字` | 大小限制（MB） | 只同步小于此大小的文件，超出时提示 |

### 配置示例

```ini
# 不同步文件
max_file_size = false

# 只同步小于5MB的文件
max_file_size = 5

# 只同步小于10MB的文件
max_file_size = 10

# 无限制（不推荐）
max_file_size = 0
```

## 🚀 使用方法

### 发送文件

1. **复制文件到剪贴板**
   - Windows: 右键文件 → 复制
   - macOS: 选中文件 → Cmd+C

2. **自动上传**
   - 如果文件大小符合限制，会自动上传到服务器
   - 系统托盘会显示上传成功的通知
   - 控制台会输出：`↑ 已上传文件: 文件名.txt (123.4KB)`

3. **超出限制提示**
   - 如果文件超出大小限制，会显示警告通知
   - 例如：`文件过大：video.mp4 大小 15.2MB 超出限制 5.0MB`

### 接收文件

1. **自动下载**
   - 其他设备上传文件后，会自动下载到本地临时目录
   - 默认保存路径：系统临时目录（如 `C:\Users\用户名\AppData\Local\Temp`）

2. **自动复制到剪贴板**
   - 文件下载完成后会自动放入剪贴板
   - 可以直接粘贴到目标位置

3. **通知提示**
   - 显示文件名和保存位置
   - 例如：`已接收: document.pdf 保存在: C:\Users\...\Temp`

## 📝 工作流程

### 场景1：同步文档

```
设备A（Windows）              服务器                设备B（macOS）
    │                          │                        │
    │ 1. 右键复制文件            │                        │
    ├──────[检测文件]──────────>│                        │
    │                          │                        │
    │ 2. 检查大小 (2MB < 5MB)    │                        │
    ├──[上传Base64]───────────>│                        │
    │                          ├──[存储]                │
    │ 3. 显示"上传成功"          │                        │
    │                          │                        │
    │                          │<───[轮询fetch]─────────┤ 4. 拉取更新
    │                          │                        │
    │                          │────[下载文件]─────────>│ 5. 接收文件
    │                          │                        │
    │                          │                        ├─ 6. 保存到临时目录
    │                          │                        │
    │                          │                        ├─ 7. 放入剪贴板
    │                          │                        │
    │                          │                        └─ 8. 显示"已接收"
```

### 场景2：文件过大

```
用户复制文件 → 检测大小 → 超出限制 → 显示警告 → 不上传
```

### 场景3：禁用文件同步

```
用户复制文件 → 检测到禁用配置 → 静默跳过 → 不显示提示
```

## 🔧 技术细节

### 数据传输

- **编码方式**：Base64
- **传输协议**：HTTP/JSON
- **文件存储**：内存中（服务器重启后丢失）

### 文件处理流程

1. **上传端**
   ```
   检测剪贴板 → 读取文件 → Base64编码 → JSON封装 → HTTP POST
   ```

2. **下载端**
   ```
   HTTP GET → JSON解析 → Base64解码 → 保存文件 → 设置剪贴板
   ```

### 剪贴板API

- **Windows/macOS**: PyQt5 `QMimeData.urls()`
- **文件检测**: 检查 `mime_data.hasUrls()`
- **文件路径**: `url.toLocalFile()`

## ⚠️ 注意事项

### 文件大小限制

1. **推荐设置**: 5-10MB
   - 适合文档、图片等小文件
   - 避免网络超时和内存问题

2. **不推荐**: 无限制（0）
   - 大文件会导致编码/解码耗时
   - 占用大量内存
   - 可能导致HTTP超时

### 性能考虑

| 文件大小 | Base64后大小 | 传输时间(估算) | 建议 |
|---------|-------------|---------------|------|
| 1MB | ~1.33MB | < 1秒 | ✅ 推荐 |
| 5MB | ~6.67MB | < 5秒 | ✅ 可用 |
| 10MB | ~13.3MB | < 10秒 | ⚠️  谨慎 |
| 50MB+ | ~66.7MB+ | > 30秒 | ❌ 不推荐 |

### 安全考虑

1. **本地网络使用**
   - 当前使用HTTP明文传输
   - 建议仅在可信内网使用
   - 不要传输敏感文件

2. **数据持久化**
   - 服务器重启后数据丢失
   - 临时文件会保留在系统临时目录
   - 可手动清理临时文件

### 已知限制

1. **单文件同步**
   - 目前只支持同步剪贴板中的第一个文件
   - 多文件选择时只同步第一个

2. **文件夹不支持**
   - 不支持同步整个文件夹
   - 需要压缩为zip后同步

3. **文件类型**
   - 理论上支持所有文件类型
   - 但大型二进制文件（视频、镜像）不推荐

## 🐛 故障排查

### 问题1: 文件没有同步

**检查项**:
- [ ] 配置中 `max_file_size` 不是 `false`
- [ ] 文件大小是否超出限制
- [ ] 控制台是否有错误信息
- [ ] 网络连接是否正常

### 问题2: 提示"文件过大"

**解决方案**:
1. 增加 `max_file_size` 配置值
2. 或压缩文件后再同步
3. 或使用其他方式传输大文件

### 问题3: 接收的文件找不到

**说明**:
- 文件保存在系统临时目录
- Windows: `C:\Users\用户名\AppData\Local\Temp`
- macOS: `/tmp` 或 `$TMPDIR`
- 文件已在剪贴板中，直接粘贴即可

### 问题4: 文件同步后无法打开

**可能原因**:
- Base64编码/解码错误
- 文件传输不完整
- 文件权限问题

**解决方案**:
1. 检查控制台错误信息
2. 尝试重新复制文件
3. 确认原文件完整性

## 💡 使用建议

### 适合同步的文件

✅ **推荐**:
- 文档文件 (.txt, .doc, .pdf)
- 小图片 (.jpg, .png < 5MB)
- 配置文件 (.ini, .json, .xml)
- 代码片段 (.py, .js, .cpp)
- 压缩包 (.zip, .rar < 10MB)

❌ **不推荐**:
- 大视频文件
- ISO镜像文件
- 整个软件安装包
- 超过50MB的文件

### 最佳实践

1. **合理设置限制**
   ```ini
   # 个人使用
   max_file_size = 5
   
   # 团队协作（文档为主）
   max_file_size = 10
   
   # 临时传输大文件
   max_file_size = 50
   ```

2. **定期清理**
   - 定期清理系统临时目录
   - 避免累积过多文件

3. **网络考虑**
   - 移动网络下降低大小限制
   - WiFi下可适当放宽

## 🔄 版本历史

### v1.0.1 (当前版本)
- ✅ 新增文件同步功能
- ✅ 支持文件大小限制配置
- ✅ 超出限制时显示警告
- ✅ 禁用时静默跳过
- ✅ Base64编码传输
- ✅ 自动保存到临时目录

### 未来计划
- [ ] 支持多文件同步
- [ ] 支持文件夹同步（自动压缩）
- [ ] 文件加密传输
- [ ] 自定义保存目录
- [ ] 文件历史记录
- [ ] 断点续传（大文件）

## 📞 反馈与支持

如遇到问题或有功能建议，请：
1. 查看控制台输出
2. 检查配置文件
3. 参考本文档的故障排查部分

---

**享受跨设备文件同步的便利！** 📁✨

