# 图片同步功能使用指南

## 📋 功能概述

SyncClipboard 现已支持剪贴板图片同步功能！可以同步截图、复制的图片等。

## ✨ 支持的场景

### ✅ 完全支持

1. **截图工具**
   - Windows: Win+Shift+S（截图工具）
   - macOS: Cmd+Shift+4（截图到剪贴板）
   - 第三方截图工具（Snipaste、QQ截图等）

2. **图片复制**
   - 浏览器中右键复制图片
   - 图片查看器中复制图片
   - Office文档中复制图片

3. **图片编辑**
   - Photoshop/GIMP等编辑后复制
   - 画图工具中的图片

## 🚀 使用方法

### 发送图片

**方式1: 截图**
```
1. 使用截图工具截图（Win+Shift+S 或 Cmd+Shift+4）
2. 图片自动复制到剪贴板
3. 程序自动检测并上传
4. 看到通知："📤 图片同步 - 已上传: 1920x1080 (245.3KB)"
```

**方式2: 复制图片**
```
1. 在浏览器/文件夹中右键图片
2. 选择"复制图片"或"复制"
3. 程序自动上传
```

### 接收图片

```
1. 其他设备上传图片后自动接收
2. 看到通知："📥 图片同步 - 已接收: 1920x1080"
3. 图片已在剪贴板中
4. 按 Ctrl+V 可直接粘贴到任何支持的应用
```

## 📊 技术细节

### 图片格式

- **存储格式**: PNG（保证质量）
- **传输格式**: Base64编码
- **支持格式**: 所有QImage支持的格式
  - PNG, JPEG, BMP, GIF, TIFF等

### 图片处理流程

#### 上传流程
```
截图/复制图片 → QImage对象 → 转PNG → Base64编码 → 上传服务器
```

#### 下载流程
```
从服务器拉取 → Base64解码 → QImage对象 → 设置到剪贴板
```

### 大小限制

图片同步使用与文件同步相同的大小限制：

```ini
[client]
# 限制5MB（适合大多数截图）
max_file_size = 5

# 限制10MB（适合高分辨率截图）
max_file_size = 10

# 禁用图片和文件同步
max_file_size = false

# 无限制（不推荐）
max_file_size = 0
```

## 💡 推荐配置

### 根据使用场景

| 场景 | 推荐限制 | 说明 |
|------|---------|------|
| 普通截图 | 5MB | 适合1080p截图 |
| 4K截图 | 10MB | 适合高分辨率 |
| 设计工作 | 20MB | 适合设计稿 |
| 仅文本 | false | 禁用图片同步 |

### 图片大小参考

| 分辨率 | 格式 | 大小估算 |
|--------|------|---------|
| 1920x1080 | PNG | 1-3MB |
| 2560x1440 | PNG | 2-5MB |
| 3840x2160 | PNG | 5-15MB |
| 截图（压缩） | PNG | 100KB-2MB |

## 🔍 循环上传防护

### 问题

粘贴图片后，Windows可能会更新剪贴板，导致重复上传。

### 解决方案

使用**图片哈希**识别相同图片：

```python
# 接收图片时记录哈希
last_received_image_hash = get_image_hash(image)

# 检测到剪贴板图片变化时
if image_hash == last_received_image_hash:
    print("⏭️  跳过刚接收的图片")
    continue  # 不上传
```

### 保护期

- 接收图片后3秒内，相同图片不会重复上传
- 3秒后自动清除保护，允许手动复制相同图片

## 📱 跨平台支持

### Windows

✅ **完全支持**
- Win+Shift+S 截图
- 第三方截图工具
- 浏览器复制图片
- Office文档复制图片

### macOS

✅ **完全支持**
- Cmd+Shift+4 截图
- 预览应用复制图片
- Safari复制图片
- 所有标准剪贴板图片

### Linux

⚠️  **理论支持**
- 取决于PyQt5在Linux上的剪贴板实现
- 建议测试后使用

## 🎯 使用示例

### 示例1: 截图同步

**设备A（Windows）**:
```
1. 按 Win+Shift+S 截图
2. 框选区域
3. 看到通知："📤 图片同步 - 已上传: 1920x1080 (234.5KB)"
```

**设备B（macOS）**:
```
1. 自动接收
2. 看到通知："📥 图片同步 - 已接收: 1920x1080"
3. 打开任意应用（微信、QQ、Word等）
4. Cmd+V 粘贴图片
```

### 示例2: 浏览器图片

```
1. 在网页上右键图片
2. 选择"复制图片"
3. 程序自动上传
4. 其他设备可以直接粘贴
```

### 示例3: 设计稿分享

```
1. Photoshop中编辑完成
2. Ctrl+A 全选，Ctrl+C 复制
3. 自动上传到服务器
4. 同事的设备自动接收
5. 直接粘贴到其他应用查看
```

## ⚠️ 注意事项

### 1. 图片质量

- 使用PNG格式保证质量
- 不会压缩图片（保持原始质量）
- 文件大小可能较大

### 2. 大小限制

超出限制时会显示提示：
```
⚠️  图片过大: 3840x2160
大小 15.2MB 超出限制 5.0MB
```

### 3. 内存使用

- 图片在内存中处理
- 大图片会占用较多内存
- 建议合理设置大小限制

### 4. 网络传输

- 图片使用Base64编码（增加约33%大小）
- 5MB图片 → 约6.67MB传输
- 确保网络带宽充足

## 🐛 故障排查

### 问题1: 截图后没有同步

**检查项**:
- [ ] `max_file_size` 不是 `false`
- [ ] 截图大小是否超出限制
- [ ] 控制台是否有错误信息

**诊断**:
```bash
# 启动客户端，查看输出
python client_gui.py

# 截图后应该看到：
↑ 已上传图片: 1920x1080 (234.5KB)
```

### 问题2: 接收后无法粘贴

**可能原因**:
- 目标应用不支持粘贴图片
- 剪贴板被其他内容覆盖

**解决方案**:
- 尝试粘贴到画图/Word等支持图片的应用
- 检查控制台是否显示"✅ 图片已设置到剪贴板"

### 问题3: 图片过大无法同步

**解决方案**:
```ini
# 方案1: 增加限制
max_file_size = 10

# 方案2: 使用图片压缩工具
# 先压缩图片再截图/复制

# 方案3: 使用文件同步
# 保存为文件后同步
```

### 问题4: 循环上传

**症状**:
```
↑ 已上传图片: 1920x1080
↓ 从服务端同步图片: 1920x1080
↑ 已上传图片: 1920x1080  # 重复上传
```

**解决方案**:
- 已内置循环检测机制
- 如果仍然出现，请报告问题

## 📊 性能考虑

### 截图大小估算

| 屏幕分辨率 | 全屏截图 | 部分截图 |
|-----------|---------|---------|
| 1920x1080 | 2-4MB | 100KB-1MB |
| 2560x1440 | 3-6MB | 200KB-2MB |
| 3840x2160 | 8-15MB | 500KB-5MB |

### 推荐实践

1. **合理设置限制**
   ```ini
   # 1080p用户
   max_file_size = 5
   
   # 2K/4K用户
   max_file_size = 10
   ```

2. **避免全屏截图**
   - 只截取需要的区域
   - 减少传输时间和存储

3. **使用压缩工具**
   - 对于大图片，先压缩再同步
   - 或使用JPEG格式（需要先保存为文件）

## 🎨 高级用法

### 配合其他工具

1. **Snipaste**
   ```
   截图 → 自动复制到剪贴板 → 自动同步
   ```

2. **ShareX**
   ```
   截图 → 编辑 → 复制 → 自动同步
   ```

3. **Photoshop**
   ```
   编辑 → 复制 → 自动同步 → 其他设备粘贴
   ```

### 工作流示例

**设计师工作流**:
```
Mac上设计 → 复制设计稿 → 
Windows上自动接收 → 粘贴到演示文稿
```

**开发者工作流**:
```
笔记本截取错误信息 → 
台式机自动接收 → 粘贴到文档
```

## 🔒 隐私和安全

### 数据存储

- 图片存储在服务器内存中
- 服务器重启后数据丢失
- 不会保存到磁盘

### 建议

1. **内网使用**: 建议在可信内网使用
2. **敏感内容**: 避免同步敏感图片
3. **HTTPS**: 生产环境建议使用HTTPS

## 📞 获取帮助

如遇到问题：

1. 查看控制台输出
2. 检查配置文件
3. 参考本文档的故障排查部分

---

**享受跨设备图片同步的便利！** 📸✨

